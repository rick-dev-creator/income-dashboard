@page "/streams"
@using Income.Application.Services.Streams
@using Income.Application.Services.Providers
@using Analytics.Application.Services
@inject IStreamService StreamService
@inject IProviderService ProviderService
@inject IDashboardService DashboardService
@inject IDialogService DialogService
@inject ISnackbar Snackbar
@rendermode InteractiveServer

<PageTitle>Income Streams - FlowMetrics</PageTitle>

<div class="page-header">
    <div>
        <h1 class="page-title">Income Streams</h1>
        <p class="page-subtitle">Manage and track your income sources</p>
    </div>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="btn-modern"
               StartIcon="@Icons.Material.Rounded.Add" OnClick="OpenCreateDialog">
        Add Stream
    </MudButton>
</div>

@if (_isLoading)
{
    <div class="loading-container">
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mt-3">Loading streams...</MudText>
    </div>
}
else if (_streams.Count == 0)
{
    <div class="empty-state-card animate-scale-in">
        <div class="empty-state-icon">
            <MudIcon Icon="@Icons.Material.Rounded.AccountBalanceWallet" Size="Size.Large" />
        </div>
        <h2>No Income Streams Yet</h2>
        <p>Start tracking your income by adding your first stream</p>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-4 btn-modern"
                   StartIcon="@Icons.Material.Rounded.Add" OnClick="OpenCreateDialog">
            Add Your First Stream
        </MudButton>
    </div>
}
else
{
    <!-- Summary Stats -->
    <div class="stats-row animate-slide-up">
        <div class="mini-stat">
            <div class="mini-stat-icon gradient-primary">
                <MudIcon Icon="@Icons.Material.Rounded.Layers" Size="Size.Small" />
            </div>
            <div class="mini-stat-content">
                <span class="mini-stat-value">@_streams.Count</span>
                <span class="mini-stat-label">Total Streams</span>
            </div>
        </div>
        <div class="mini-stat">
            <div class="mini-stat-icon gradient-success">
                <MudIcon Icon="@Icons.Material.Rounded.TrendingUp" Size="Size.Small" />
            </div>
            <div class="mini-stat-content">
                <span class="mini-stat-value text-success">@(_streamHealth?.GrowingCount ?? 0)</span>
                <span class="mini-stat-label">Growing</span>
            </div>
        </div>
        <div class="mini-stat">
            <div class="mini-stat-icon gradient-dark">
                <MudIcon Icon="@Icons.Material.Rounded.TrendingFlat" Size="Size.Small" />
            </div>
            <div class="mini-stat-content">
                <span class="mini-stat-value">@(_streamHealth?.StableCount ?? 0)</span>
                <span class="mini-stat-label">Stable</span>
            </div>
        </div>
        <div class="mini-stat">
            <div class="mini-stat-icon gradient-error">
                <MudIcon Icon="@Icons.Material.Rounded.TrendingDown" Size="Size.Small" />
            </div>
            <div class="mini-stat-content">
                <span class="mini-stat-value text-error">@(_streamHealth?.DecliningCount ?? 0)</span>
                <span class="mini-stat-label">Declining</span>
            </div>
        </div>
    </div>

    <!-- Stream Cards Grid -->
    <div class="streams-grid animate-slide-up" style="animation-delay: 0.1s;">
        @foreach (var stream in _streams)
        {
            var health = GetStreamHealth(stream.Id);
            var monthlyIncome = health?.CurrentPeriodUsd ?? 0;
            var dailyRate = monthlyIncome / 30m;
            var contribution = _totalMonthlyIncome > 0 ? (monthlyIncome / _totalMonthlyIncome * 100) : 0;

            <div class="stream-card hover-lift @(stream.SyncState == StreamSyncState.Disabled ? "stream-disabled" : "")">
                @if (stream.SyncState == StreamSyncState.Disabled)
                {
                    <div class="disabled-badge">
                        <MudIcon Icon="@Icons.Material.Rounded.PauseCircle" Size="Size.Small" />
                        Disabled
                    </div>
                }
                <!-- Header: Name + Provider + Trend -->
                <div class="stream-card-header">
                    <div class="stream-avatar @GetCategoryClass(stream.Category)">
                        @stream.Name[0]
                    </div>
                    <div class="stream-header-info">
                        <div class="stream-title-row">
                            <span class="stream-title">@stream.Name</span>
                            @if (health is not null && health.ChangePercentage != 0)
                            {
                                <span class="trend-chip @GetTrendChipClass(health.Direction)">
                                    <MudIcon Icon="@GetDirectionIcon(health.Direction)" Size="Size.Small" />
                                    @FormatSignedPercentage(health.ChangePercentage)
                                </span>
                            }
                        </div>
                        <span class="stream-subtitle">@GetProviderName(stream.ProviderId)</span>
                    </div>
                    <MudMenu Icon="@Icons.Material.Rounded.MoreVert" Size="Size.Small" AnchorOrigin="Origin.BottomRight">
                        <MudMenuItem Icon="@Icons.Material.Rounded.Edit" OnClick="@(() => OpenEditDialog(stream))">
                            Edit
                        </MudMenuItem>
                        <MudMenuItem Icon="@Icons.Material.Rounded.AddChart" OnClick="@(() => OpenSnapshotDialog(stream))" Disabled="@(stream.SyncState == StreamSyncState.Disabled)">
                            Record Income
                        </MudMenuItem>
                        <MudMenuItem Icon="@(stream.SyncState == StreamSyncState.Disabled ? Icons.Material.Rounded.PlayArrow : Icons.Material.Rounded.Pause)"
                                     IconColor="@(stream.SyncState == StreamSyncState.Disabled ? Color.Success : Color.Warning)"
                                     OnClick="@(() => ToggleStreamStatus(stream))">
                            @(stream.SyncState == StreamSyncState.Disabled ? "Enable" : "Disable")
                        </MudMenuItem>
                        <MudDivider Class="my-1" />
                        <MudMenuItem Icon="@Icons.Material.Rounded.Delete" IconColor="Color.Error" OnClick="@(() => DeleteStream(stream))">
                            Delete
                        </MudMenuItem>
                    </MudMenu>
                </div>

                <!-- Main Metrics: Monthly Income + Daily Rate -->
                <div class="stream-metrics">
                    <div class="metric-primary">
                        <span class="metric-value">@FormatCurrency(monthlyIncome)</span>
                        <span class="metric-label">/month</span>
                    </div>
                    <div class="metric-secondary">
                        <span class="metric-value-small">@FormatCurrency(dailyRate)</span>
                        <span class="metric-label-small">/day</span>
                    </div>
                </div>

                <!-- Contribution Bar -->
                <div class="contribution-section">
                    <div class="contribution-bar-container">
                        <div class="contribution-bar @GetCategoryClass(stream.Category)" style="width: @contribution.ToString("F0")%"></div>
                    </div>
                    <span class="contribution-text">@contribution.ToString("F1")% of total income</span>
                </div>

                <!-- Footer: Metadata -->
                <div class="stream-card-footer">
                    <div class="stream-meta">
                        <span class="category-badge @GetCategoryClass(stream.Category)">@stream.Category</span>
                        <span class="meta-separator">•</span>
                        <span class="meta-text">@(stream.IsFixed ? stream.FixedPeriod : "Variable")</span>
                        <span class="meta-separator">•</span>
                        <span class="meta-text">@stream.OriginalCurrency</span>
                    </div>
                    <div class="stream-activity">
                        @if (stream.LastSnapshot is not null)
                        {
                            <MudIcon Icon="@Icons.Material.Rounded.Schedule" Size="Size.Small" />
                            <span>@stream.LastSnapshot.Date.ToString("MMM dd")</span>
                            <span class="meta-separator">•</span>
                            <span>@stream.SnapshotCount entries</span>
                        }
                        else
                        {
                            <MudIcon Icon="@Icons.Material.Rounded.Info" Size="Size.Small" />
                            <span>No entries yet</span>
                        }
                    </div>
                </div>

                <button class="record-btn" @onclick="@(() => OpenSnapshotDialog(stream))">
                    <MudIcon Icon="@Icons.Material.Rounded.Add" Size="Size.Small" />
                    <span>Record Income</span>
                </button>
            </div>
        }
    </div>
}

<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 32px;
    }

    .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 400px;
    }

    .empty-state-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 64px 32px;
        background: var(--mud-palette-surface);
        border: 1px solid var(--mud-palette-divider);
        border-radius: 20px;
        text-align: center;
    }

    .empty-state-card .empty-state-icon {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--mud-palette-primary) 0%, var(--mud-palette-secondary) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        margin-bottom: 24px;
    }

    .empty-state-card h2 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .empty-state-card p {
        color: var(--mud-palette-text-secondary);
        margin-bottom: 0;
    }

    .stats-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-bottom: 24px;
    }

    .mini-stat {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: var(--mud-palette-surface);
        border: 1px solid var(--mud-palette-divider);
        border-radius: 12px;
    }

    .mini-stat-icon {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        flex-shrink: 0;
    }

    .mini-stat-content {
        display: flex;
        flex-direction: column;
    }

    .mini-stat-value {
        font-size: 1.25rem;
        font-weight: 700;
    }

    .mini-stat-label {
        font-size: 0.75rem;
        color: var(--mud-palette-text-secondary);
    }

    .text-success { color: var(--mud-palette-success); }
    .text-error { color: var(--mud-palette-error); }

    .streams-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 20px;
    }

    .stream-card {
        background: var(--mud-palette-surface);
        border: 1px solid var(--mud-palette-divider);
        border-radius: 16px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .stream-card.stream-disabled {
        opacity: 0.6;
        border-color: var(--mud-palette-warning);
    }

    .disabled-badge {
        position: absolute;
        top: 12px;
        right: 50px;
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 4px 10px;
        background: rgba(245, 158, 11, 0.2);
        color: var(--mud-palette-warning);
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 600;
        z-index: 1;
    }

    .stream-card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 20px 20px 16px;
    }

    .stream-avatar {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1.125rem;
        color: white;
        flex-shrink: 0;
    }

    .stream-avatar.category-salary { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
    .stream-avatar.category-trading { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .stream-avatar.category-subscription { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    .stream-avatar.category-referral { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .stream-avatar.category-rental { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
    .stream-avatar.category-dividend { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
    .stream-avatar.category-default { background: linear-gradient(135deg, #64748b 0%, #475569 100%); }

    .stream-header-info {
        flex: 1;
        min-width: 0;
    }

    .stream-title-row {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }

    .stream-title {
        font-weight: 600;
        font-size: 1rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .stream-subtitle {
        font-size: 0.8125rem;
        color: var(--mud-palette-text-secondary);
    }

    .trend-chip {
        display: inline-flex;
        align-items: center;
        gap: 2px;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .trend-chip-up { background: rgba(16, 185, 129, 0.15); color: #10b981; }
    .trend-chip-down { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .trend-chip-flat { background: var(--mud-palette-divider); color: var(--mud-palette-text-secondary); }

    /* Main Metrics Section */
    .stream-metrics {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        padding: 16px 20px;
        background: var(--mud-palette-background);
        margin: 0 12px;
        border-radius: 12px;
    }

    .metric-primary {
        display: flex;
        align-items: baseline;
        gap: 4px;
    }

    .metric-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--mud-palette-success);
    }

    .metric-label {
        font-size: 0.875rem;
        color: var(--mud-palette-text-secondary);
    }

    .metric-secondary {
        display: flex;
        align-items: baseline;
        gap: 2px;
        text-align: right;
    }

    .metric-value-small {
        font-size: 1rem;
        font-weight: 600;
    }

    .metric-label-small {
        font-size: 0.75rem;
        color: var(--mud-palette-text-secondary);
    }

    /* Contribution Section */
    .contribution-section {
        padding: 12px 20px;
    }

    .contribution-bar-container {
        height: 6px;
        background: var(--mud-palette-divider);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 6px;
    }

    .contribution-bar {
        height: 100%;
        border-radius: 3px;
        transition: width 0.5s ease;
    }

    .contribution-bar.category-salary { background: linear-gradient(90deg, #6366f1 0%, #818cf8 100%); }
    .contribution-bar.category-trading { background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%); }
    .contribution-bar.category-subscription { background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%); }
    .contribution-bar.category-referral { background: linear-gradient(90deg, #10b981 0%, #34d399 100%); }
    .contribution-bar.category-rental { background: linear-gradient(90deg, #8b5cf6 0%, #a78bfa 100%); }
    .contribution-bar.category-dividend { background: linear-gradient(90deg, #ec4899 0%, #f472b6 100%); }
    .contribution-bar.category-default { background: var(--mud-palette-text-secondary); }

    .contribution-text {
        font-size: 0.75rem;
        color: var(--mud-palette-text-secondary);
    }

    .category-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 0.7rem;
        font-weight: 500;
    }

    .category-badge.category-salary { background: rgba(99, 102, 241, 0.15); color: #818cf8; }
    .category-badge.category-trading { background: rgba(245, 158, 11, 0.15); color: #fbbf24; }
    .category-badge.category-subscription { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
    .category-badge.category-referral { background: rgba(16, 185, 129, 0.15); color: #34d399; }
    .category-badge.category-rental { background: rgba(139, 92, 246, 0.15); color: #a78bfa; }
    .category-badge.category-dividend { background: rgba(236, 72, 153, 0.15); color: #f472b6; }
    .category-badge.category-default { background: var(--mud-palette-divider); color: var(--mud-palette-text-secondary); }

    .stream-card-footer {
        padding: 12px 20px;
        margin-top: auto;
        border-top: 1px solid var(--mud-palette-divider);
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .stream-meta {
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
    }

    .meta-separator {
        color: var(--mud-palette-text-disabled);
        font-size: 0.75rem;
    }

    .meta-text {
        font-size: 0.8125rem;
        color: var(--mud-palette-text-secondary);
    }

    .stream-activity {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        color: var(--mud-palette-text-secondary);
    }

    .record-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 14px;
        background: transparent;
        border: none;
        border-top: 1px solid var(--mud-palette-divider);
        color: var(--mud-palette-primary);
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .record-btn:hover {
        background: var(--mud-palette-primary);
        color: white;
    }

    @@media (max-width: 959px) {
        .stats-row {
            grid-template-columns: repeat(2, 1fr);
        }

        .streams-grid {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
    }

    @@media (max-width: 599px) {
        .page-header {
            flex-direction: column;
            gap: 16px;
            align-items: stretch;
        }

        .page-header .btn-modern {
            width: 100%;
        }

        .stats-row {
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .mini-stat {
            padding: 12px;
            gap: 10px;
        }

        .mini-stat-icon {
            width: 36px;
            height: 36px;
        }

        .mini-stat-value {
            font-size: 1.125rem;
        }

        .streams-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .stream-card-header {
            padding: 16px 16px 12px;
        }

        .stream-avatar {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }

        .stream-title {
            font-size: 0.9375rem;
        }

        .stream-card-body {
            padding: 0 16px;
        }

        .stream-card-footer {
            padding: 12px 16px;
        }

        .snapshot-amount .amount {
            font-size: 1.125rem;
        }

        .record-btn {
            padding: 12px;
        }
    }
</style>

@code {
    private bool _isLoading = true;
    private List<StreamListItem> _streams = [];
    private Dictionary<string, ProviderListItem> _providers = [];
    private StreamHealthSummary? _streamHealth;
    private Dictionary<string, StreamHealthItem> _streamHealthMap = [];
    private decimal _totalMonthlyIncome;

    protected override async Task OnInitializedAsync()
    {
        await LoadDataAsync();
    }

    private async Task LoadDataAsync()
    {
        _isLoading = true;

        var streamsResult = await StreamService.GetAllAsync();
        var providersResult = await ProviderService.GetAllAsync();
        var healthResult = await DashboardService.GetStreamHealthAsync("MoM");

        if (streamsResult.IsSuccess)
            _streams = streamsResult.Value.ToList();

        if (providersResult.IsSuccess)
            _providers = providersResult.Value.ToDictionary(p => p.Id, p => p);

        if (healthResult.IsSuccess)
        {
            _streamHealth = healthResult.Value;
            _streamHealthMap = _streamHealth.Streams.ToDictionary(s => s.StreamId, s => s);
            _totalMonthlyIncome = _streamHealth.Streams.Sum(s => s.CurrentPeriodUsd);
        }

        _isLoading = false;
    }

    private StreamHealthItem? GetStreamHealth(string streamId) =>
        _streamHealthMap.TryGetValue(streamId, out var health) ? health : null;

    private string GetProviderName(string providerId) =>
        _providers.TryGetValue(providerId, out var provider) ? provider.Name : providerId;

    private static string GetCategoryClass(string category) => $"category-{category.ToLower()}";

    private static string GetDirectionIcon(string? direction) => direction switch
    {
        "Upward" => Icons.Material.Rounded.TrendingUp,
        "Downward" => Icons.Material.Rounded.TrendingDown,
        _ => Icons.Material.Rounded.TrendingFlat
    };

    private static Color GetDirectionColor(string? direction) => direction switch
    {
        "Upward" => Color.Success,
        "Downward" => Color.Error,
        _ => Color.Default
    };

    private static string GetTrendClass(string? direction) => direction switch
    {
        "Upward" => "trend-up",
        "Downward" => "trend-down",
        _ => "trend-flat"
    };

    private static string GetTrendChipClass(string? direction) => direction switch
    {
        "Upward" => "trend-chip-up",
        "Downward" => "trend-chip-down",
        _ => "trend-chip-flat"
    };

    private static string FormatCurrency(decimal amount) =>
        amount.ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("en-US"));

    private static string FormatSignedPercentage(decimal percentage) =>
        $"{(percentage >= 0 ? "+" : "")}{percentage:F1}%";

    private async Task OpenCreateDialog()
    {
        var parameters = new DialogParameters<StreamDialog>
        {
            { x => x.Providers, _providers.Values.ToList() }
        };

        var dialog = await DialogService.ShowAsync<StreamDialog>("Create Stream", parameters,
            new DialogOptions { MaxWidth = MaxWidth.Small, FullWidth = true });

        var result = await dialog.Result;
        if (result is { Canceled: false, Data: CreateStreamRequest request })
        {
            var createResult = await StreamService.CreateAsync(request);
            if (createResult.IsSuccess)
            {
                Snackbar.Add("Stream created successfully!", Severity.Success);
                await LoadDataAsync();
            }
            else
            {
                Snackbar.Add($"Error: {createResult.Errors.FirstOrDefault()?.Message}", Severity.Error);
            }
        }
    }

    private async Task OpenEditDialog(StreamListItem stream)
    {
        var parameters = new DialogParameters<StreamDialog>
        {
            { x => x.Providers, _providers.Values.ToList() },
            { x => x.ExistingStream, stream }
        };

        var dialog = await DialogService.ShowAsync<StreamDialog>("Edit Stream", parameters,
            new DialogOptions { MaxWidth = MaxWidth.Small, FullWidth = true });

        var result = await dialog.Result;
        if (result is { Canceled: false, Data: UpdateStreamRequest request })
        {
            var updateResult = await StreamService.UpdateAsync(request);
            if (updateResult.IsSuccess)
            {
                Snackbar.Add("Stream updated successfully!", Severity.Success);
                await LoadDataAsync();
            }
            else
            {
                Snackbar.Add($"Error: {updateResult.Errors.FirstOrDefault()?.Message}", Severity.Error);
            }
        }
    }

    private async Task OpenSnapshotDialog(StreamListItem stream)
    {
        var parameters = new DialogParameters<SnapshotDialog>
        {
            { x => x.Stream, stream }
        };

        var dialog = await DialogService.ShowAsync<SnapshotDialog>("Record Snapshot", parameters,
            new DialogOptions { MaxWidth = MaxWidth.Small, FullWidth = true });

        var result = await dialog.Result;
        if (result is { Canceled: false, Data: RecordSnapshotRequest request })
        {
            var snapshotResult = await StreamService.RecordSnapshotAsync(request);
            if (snapshotResult.IsSuccess)
            {
                Snackbar.Add("Snapshot recorded successfully!", Severity.Success);
                await LoadDataAsync();
            }
            else
            {
                Snackbar.Add($"Error: {snapshotResult.Errors.FirstOrDefault()?.Message}", Severity.Error);
            }
        }
    }

    private async Task DeleteStream(StreamListItem stream)
    {
        var confirmed = await DialogService.ShowMessageBox(
            "Delete Stream",
            $"Are you sure you want to delete '{stream.Name}'? This will also delete all associated snapshots.",
            yesText: "Delete",
            cancelText: "Cancel");

        if (confirmed == true)
        {
            var deleteResult = await StreamService.DeleteAsync(stream.Id);
            if (deleteResult.IsSuccess)
            {
                Snackbar.Add("Stream deleted successfully!", Severity.Success);
                await LoadDataAsync();
            }
            else
            {
                Snackbar.Add($"Error: {deleteResult.Errors.FirstOrDefault()?.Message}", Severity.Error);
            }
        }
    }

    private async Task ToggleStreamStatus(StreamListItem stream)
    {
        var isDisabled = stream.SyncState == StreamSyncState.Disabled;
        var action = isDisabled ? "enable" : "disable";

        var toggleResult = await StreamService.ToggleStatusAsync(stream.Id);
        if (toggleResult.IsSuccess)
        {
            Snackbar.Add($"Stream {(isDisabled ? "enabled" : "disabled")} successfully!", Severity.Success);
            await LoadDataAsync();
        }
        else
        {
            Snackbar.Add($"Error: {toggleResult.Errors.FirstOrDefault()?.Message}", Severity.Error);
        }
    }
}
