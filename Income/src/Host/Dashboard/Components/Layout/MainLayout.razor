@inherits LayoutComponentBase
@inject MudTheme Theme

<MudThemeProvider Theme="Theme" @bind-IsDarkMode="_isDarkMode" />

<MudLayout>
    <MudAppBar Elevation="1" Class="app-bar">
        <MudIconButton Icon="@Icons.Material.Rounded.Menu"
                       Color="Color.Inherit"
                       Edge="Edge.Start"
                       OnClick="@ToggleDrawer" />

        <div class="brand">
            <div class="brand-icon">
                <MudIcon Icon="@Icons.Material.Rounded.ShowChart" Size="Size.Small" />
            </div>
            <MudText Typo="Typo.h6" Class="brand-text">FlowMetrics</MudText>
        </div>

        <MudSpacer />

        <MudTooltip Text="@(_isDarkMode ? "Light mode" : "Dark mode")" Placement="Placement.Bottom">
            <MudIconButton Icon="@(_isDarkMode ? Icons.Material.Rounded.LightMode : Icons.Material.Rounded.DarkMode)"
                           Color="Color.Inherit"
                           OnClick="@ToggleDarkMode" />
        </MudTooltip>

        <MudMenu Icon="@Icons.Material.Rounded.AccountCircle" Color="Color.Inherit" AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
            <MudMenuItem Icon="@Icons.Material.Rounded.Settings">Settings</MudMenuItem>
            <MudMenuItem Icon="@Icons.Material.Rounded.Help">Help</MudMenuItem>
            <MudDivider Class="my-2" />
            <MudMenuItem Icon="@Icons.Material.Rounded.Logout">Sign Out</MudMenuItem>
        </MudMenu>
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen"
               ClipMode="DrawerClipMode.Always"
               Breakpoint="Breakpoint.Md"
               Elevation="1"
               Variant="DrawerVariant.Responsive"
               Class="app-drawer">
        <MudDrawerHeader>
            <MudText Typo="Typo.subtitle1" Class="drawer-section-title">NAVIGATION</MudText>
        </MudDrawerHeader>
        <NavMenu />
        <MudSpacer />
        <div class="drawer-footer">
            <MudText Typo="Typo.caption" Color="Color.Secondary" Class="version-text">v1.0.0</MudText>
        </div>
    </MudDrawer>

    <MudMainContent Class="main-content">
        <div class="page-container">
            @Body
        </div>
    </MudMainContent>
</MudLayout>

<style>
    .app-bar {
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-left: 8px;
    }

    .brand-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: linear-gradient(135deg, var(--mud-palette-primary) 0%, var(--mud-palette-secondary) 100%);
        color: white;
    }

    .brand-text {
        font-weight: 700;
        letter-spacing: -0.02em;
        background: linear-gradient(135deg, var(--mud-palette-primary) 0%, var(--mud-palette-secondary) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .app-drawer {
        border-right: 1px solid var(--mud-palette-divider) !important;
    }

    .drawer-section-title {
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        font-weight: 600;
    }

    .drawer-footer {
        padding: 16px;
        border-top: 1px solid var(--mud-palette-divider);
    }

    .version-text {
        opacity: 0.5;
    }

    .main-content {
        background: var(--mud-palette-background);
        min-height: calc(100vh - 64px);
    }

    .page-container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 24px 32px;
    }

    @@media (max-width: 960px) {
        .page-container {
            padding: 16px;
        }

        .brand-text {
            display: none;
        }
    }
</style>

@code {
    private bool _drawerOpen = true;
    private bool _isDarkMode = true;

    private void ToggleDrawer() => _drawerOpen = !_drawerOpen;
    private void ToggleDarkMode() => _isDarkMode = !_isDarkMode;
}
